<p id="notice"><%= notice %></p>

<% if @tag.present? %>
<h1>Stories in <%= name_link @tag %>.</h1>
<% else %>
<h1>Stories</h1>
<% end %>

<%= will_paginate @stories %>
<%= page_entries_info @stories %>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% usr = current_user_or_guest %>
    <% @stories.each do |story| %>
      <% permissions = usr.story_permissions(story) %>
      <% next unless permissions[:read] %>
      <tr>
        <td><%= name_link story %></td>
        <td><%= name_link story.user %></td>
        <td><% if permissions[:edit] %>
          <%= link_to 'Edit', edit_story_path(story) %> <% end %></td>
        <td><% if permissions[:delete] %>
          <%= link_to 'Destroy', story, method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Story', new_story_path %>
