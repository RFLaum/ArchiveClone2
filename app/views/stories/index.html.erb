<p id="notice"><%= notice %></p>

<h1>Stories</h1>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% usr = current_user_or_guest %>
    <% @stories.each do |story| %>
      <% permissions = usr.story_permissions(story) %>
      <tr>
        <td><%= story.title %></td>
        <td><%= story.author %></td>
        <td><% if permissions[:read] %>
          <%= link_to 'Show', story %><% end %></td>
        <td><% if permissions[:edit] %>
          <%= link_to 'Edit', edit_story_path(story) %> <% end %></td>
        <td><% if permissions[:delete] %>
          <%= link_to 'Destroy', story, method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Story', new_story_path %>
